<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, user-scalable=no"
    />
    <title>Admin Panel â€“ PUO Map App</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    />
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet-draw/dist/leaflet.draw.css"
    />
    <link rel="stylesheet" href="../css/admin.css" />
  </head>
  <body>
    <header>
      <div
        class="d-flex justify-content-start align-items-center"
        style="z-index: 5"
      >
        <!-- Back button -->
        <i
          class="bi bi-arrow-left image"
          onclick="goBack()"
          role="button"
          aria-label="Back"
        ></i>

        <!-- Page title -->
        <div class="flex-grow-1 text-center">
          <h5 class="mb-0">PUO Admin Panel</h5>
        </div>

        <!-- Dark mode toggle -->
        <div class="form-check form-switch me-3">
          <input
            class="form-check-input"
            type="checkbox"
            id="darkModeToggle"
            style="margin-top: 13px"
          />
          <label class="form-check-label" for="darkModeToggle">
            <i class="bi bi-moon-stars"></i>
          </label>
        </div>

        <!-- Menu button -->
        <i
          class="bi bi-list"
          onclick="SidebarBtn()"
          role="button"
          aria-label="Menu"
        ></i>
      </div>
    </header>

    <!-- Sidebar - Same as main page -->
    <div class="sidebar" id="sidebarId">
      <div>
        <div>
          <button class="close-btn" onclick="closebtn()" aria-label="Close">
            <i class="bi bi-x-lg"></i>
          </button>
        </div>
        <div>
          <h2>PoliMap GO!</h2>
        </div>
      </div>
      <ul>
        <li>
          <p>ADMIN PANEL</p>
        </li>
        <li>
          <a href="inbox.html">
            <i class="bi bi-inbox"></i>
            INBOX</a
          >
        </li>
        <li>
          <a href="setting.html">
            <i class="bi bi-gear"></i>
            SETTING</a
          >
        </li>
        <li>
          <a href="map.html">
            <i class="bi bi-map"></i>
            MAP</a
          >
        </li>
        <li>
          <a href="mapDownload.html">
            <i class="bi bi-cloud-arrow-down"></i>
            MAP DOWNLOAD
          </a>
        </li>
        <li>
          <a href="about.html">
            <i class="bi bi-info-circle"></i>
            ABOUT POLIMAP</a
          >
        </li>
        <li class="admin-only">
          <a href="admin.html">
            <i class="bi bi-shield-lock"></i>
            ADMIN PAGE
          </a>
        </li>
        <li id="logoutItem">
          <a href="#" onclick="logout()" class="text-danger">
            <i class="bi bi-box-arrow-right"></i>
            LOGOUT
          </a>
        </li>
      </ul>
    </div>

    <div class="container-fluid mt-3">
      <div class="row">
        <!-- Left Column - Map -->
        <div class="col-lg-8">
          <div class="section-card">
            <div class="section-header d-flex align-items-center">
              <h5 class="mb-0">Map</h5>
              <!-- Info Icon -->
              <i
                class="bi bi-info-circle fs-3 text-primary"
                role="button"
                onclick='showInfoModal({
                  title: "Map Tools",
                  items: [
                    {
                      image: "../icon/zoom.png",
                      desc: "You just click to zoom in and out the map"
                    },{
                      image: "../icon/draw.png",
                      desc: "If you want to draw choose only one from this"
                    },{
                      image: "../icon/pentagon.png",
                      desc: "If you choose this (pentagon icon)  you can make any shape <br> by clicking the start dot untill end dot <i>make sure same dot as the first dot if you want to end it</i>"
                    },{
                      image: "../icon/edit.png",
                      desc: "If you want to edit the polygon"
                    },{
                      image: "../icon/blank.png",
                      desc: "If the map is blank/did not appear anything just click the zoom out untill it came out"
                    }
                  ]
                })'
              ></i>

              <!-- Modal -->
              <div
                class="modal fade"
                id="infoModal"
                tabindex="-1"
                aria-hidden="true"
              >
                <div class="modal-dialog modal-lg">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="modalTitle">
                        Maklumat Bangunan
                      </h5>
                      <button
                        type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                      ></button>
                    </div>
                    <div class="modal-body">
                      <div
                        id="modalCarousel"
                        class="carousel slide"
                        data-bs-ride="carousel"
                      >
                        <div class="carousel-inner" id="carouselItems"></div>

                        <button
                          class="carousel-control-prev"
                          type="button"
                          data-bs-target="#modalCarousel"
                          data-bs-slide="prev"
                        >
                          <span class="carousel-control-prev-icon"></span>
                        </button>
                        <button
                          class="carousel-control-next"
                          type="button"
                          data-bs-target="#modalCarousel"
                          data-bs-slide="next"
                        >
                          <span class="carousel-control-next-icon"></span>
                        </button>
                      </div>
                    </div>

                    <div class="modal-footer">
                      <button class="btn btn-secondary" data-bs-dismiss="modal">
                        Close
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="section-body">
              <div id="map" style="height: 500px"></div>
              <div class="mt-3">
                <div class="btn-group">
                  <button
                    type="button"
                    class="btn btn-outline-primary btn-sm"
                    onclick="enableDrawing()"
                  >
                    <i class="bi bi-pencil"></i> Draw Building
                  </button>
                  <button
                    type="button"
                    class="btn btn-outline-secondary btn-sm"
                    onclick="disableDrawing()"
                  >
                    <i class="bi bi-cursor"></i> Select Mode
                  </button>
                </div>
                <small class="text-muted d-block mt-1"
                  >Draw polygons to create buildings or click existing ones to
                  edit</small
                >
              </div>
            </div>
          </div>
        </div>

        <!-- Right Column - Forms -->
        <div class="col-lg-4">
          <!-- Tab Navigation -->
          <ul class="nav nav-pills mb-3" id="adminTabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button
                class="nav-link active"
                id="maps-tab"
                data-bs-toggle="pill"
                data-bs-target="#maps"
                type="button"
                role="tab"
              >
                <i class="bi bi-building"></i> Maps & Buildings
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="notifications-tab"
                data-bs-toggle="pill"
                data-bs-target="#notifications"
                type="button"
                role="tab"
              >
                <i class="bi bi-megaphone"></i> Notifications
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="documents-tab"
                data-bs-toggle="pill"
                data-bs-target="#documents"
                type="button"
                role="tab"
              >
                <i class="bi bi-files"></i> Documents
              </button>
            </li>
            <!-- Future tabs can be added here -->
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="settings-tab"
                data-bs-toggle="pill"
                data-bs-target="#settings"
                type="button"
                role="tab"
                disabled
              >
                <i class="bi bi-gear"></i> Placeholder
              </button>
            </li>
          </ul>

          <div class="tab-content" id="adminTabContent">
            <!-- TAB 1: Maps & Buildings -->
            <div class="tab-pane fade show active" id="maps" role="tabpanel">
              <!-- Building Management -->
              <div class="section-card">
                <div class="section-header">
                  <h5 class="mb-0">Building Management</h5>
                </div>
                <div class="section-body">
                  <form id="buildingForm">
                    <input type="hidden" id="buildingId" />
                    <div class="mb-3">
                      <label class="form-label">Building Name</label>
                      <input
                        type="text"
                        id="buildingName"
                        class="form-control"
                        placeholder="e.g., Main Campus Building"
                      />
                    </div>
                    <div class="mb-3">
                      <label class="form-label">Building Color</label>
                      <select id="buildingColor" class="form-select">
                        <option value="blue">â–  Blue - Default</option>
                        <option value="red">â–  Red - Emergency</option>
                        <option value="green">â–  Green - Sport</option>
                        <option value="purple">
                          â–  Purple - Canteen / Cafe
                        </option>
                        <option value="orange">
                          â–  Orange - Living Quaters
                        </option>
                        <option value="#F7DC6F">â–  Yellow - Misc</option>
                      </select>
                    </div>
                    <!-- Add this after the Building Color field -->
                    <div class="mb-3">
                      <label class="form-label">Building Image</label>
                      <input
                        type="file"
                        id="buildingImage"
                        class="form-control"
                        accept="image/*"
                        onchange="previewBuildingImage(this)"
                      />
                      <small class="text-muted"
                        >Upload a photo of the building (JPG, PNG, max
                        5MB)</small
                      >

                      <!-- Image preview -->
                      <div
                        id="buildingImagePreview"
                        class="mt-2"
                        style="display: none"
                      >
                        <img
                          id="buildingPreviewImg"
                          src=""
                          alt="Building preview"
                          class="img-thumbnail"
                          style="max-height: 200px"
                        />
                        <button
                          type="button"
                          class="btn btn-sm btn-outline-danger mt-1"
                          onclick="removeBuildingImage()"
                        >
                          <i class="bi bi-trash"></i> Remove Image
                        </button>
                      </div>

                      <!-- Current image display (when editing) -->
                      <div id="currentBuildingImage" class="mt-2"></div>
                    </div>
                    <div class="mb-3">
                      <label class="form-label">Description</label>
                      <textarea
                        id="buildingInfo"
                        class="form-control"
                        rows="2"
                        placeholder="Facilities, departments, etc."
                      ></textarea>
                    </div>
                    <div class="d-grid gap-2 d-md-flex">
                      <button
                        type="button"
                        class="btn btn-success flex-fill"
                        onclick="saveBuilding()"
                      >
                        <i class="bi bi-check-lg"></i> Save Building
                      </button>
                      <button
                        type="button"
                        class="btn btn-danger"
                        onclick="deleteBuilding()"
                        disabled
                        id="deleteBuildingBtn"
                      >
                        <i class="bi bi-trash"></i> Delete
                      </button>
                    </div>
                  </form>

                  <div class="mt-3">
                    <label class="form-label">Existing Buildings</label>
                    <select
                      class="form-select"
                      id="buildingSelector"
                      onchange="selectBuildingFromList()"
                    >
                      <option value="">Select a building to edit...</option>
                    </select>
                  </div>
                </div>
              </div>

              <!-- Level & Room Management -->
              <div class="section-card mt-3">
                <div class="section-header">
                  <h5 class="mb-0">Level, Room & Staff Management</h5>
                </div>
                <div class="section-body">
                  <ul
                    class="nav nav-tabs mb-3"
                    id="levelRoomTabs"
                    role="tablist"
                  >
                    <li class="nav-item" role="presentation">
                      <button
                        class="nav-link active"
                        id="levels-tab"
                        data-bs-toggle="tab"
                        data-bs-target="#levels"
                        type="button"
                        role="tab"
                      >
                        Levels
                      </button>
                    </li>
                    <li class="nav-item" role="presentation">
                      <button
                        class="nav-link"
                        id="rooms-tab"
                        data-bs-toggle="tab"
                        data-bs-target="#rooms"
                        type="button"
                        role="tab"
                      >
                        Rooms
                      </button>
                    </li>
                    <li class="nav-item" role="presentation">
                      <button
                        class="nav-link"
                        id="staff-tab"
                        data-bs-toggle="tab"
                        data-bs-target="#staff"
                        type="button"
                        role="tab"
                      >
                        Staff
                      </button>
                    </li>
                  </ul>

                  <div class="tab-content">
                    <!-- Levels Tab -->
                    <div class="mt-3">
                      <label class="form-label">Existing Levels</label>
                      <select
                        class="form-select"
                        id="levelSelector"
                        onchange="selectLevelFromList()"
                      >
                        <option value="">Select a level...</option>
                      </select>
                    </div>

                    <div
                      class="tab-pane fade show active"
                      id="levels"
                      role="tabpanel"
                    >
                      <form id="levelForm">
                        <input type="hidden" id="levelId" />
                        <div class="mb-3">
                          <label class="form-label">Floor Level</label>
                          <input
                            type="text"
                            id="levelFloor"
                            class="form-control"
                            placeholder="e.g., Ground Floor, Level 1"
                          />
                        </div>
                        <div class="d-grid gap-2 d-md-flex">
                          <button
                            type="button"
                            class="btn btn-success flex-fill"
                            onclick="saveLevel()"
                          >
                            <i class="bi bi-check-lg"></i> Save Level
                          </button>
                          <button
                            type="button"
                            class="btn btn-danger"
                            onclick="deleteLevel()"
                            disabled
                            id="deleteLevelBtn"
                          >
                            <i class="bi bi-trash"></i> Delete
                          </button>
                        </div>
                      </form>
                    </div>

                    <!-- Rooms Tab -->
                    <div class="mt-3">
                      <label class="form-label">Existing Rooms</label>
                      <select
                        class="form-select"
                        id="roomSelector"
                        onchange="selectRoomFromList()"
                      >
                        <option value="">Select a room...</option>
                      </select>
                    </div>
                    <div class="tab-pane fade" id="rooms" role="tabpanel">
                      <form id="roomForm">
                        <input type="hidden" id="roomId" />
                        <div class="mb-3">
                          <label class="form-label">Room Name</label>
                          <input
                            type="text"
                            id="roomName"
                            class="form-control"
                            placeholder="e.g., Lecture Hall A, Lab 101"
                          />
                        </div>
                        <div class="mb-3">
                          <label class="form-label">Room Details</label>
                          <textarea
                            id="roomInfo"
                            class="form-control"
                            rows="2"
                            placeholder="Equipment, capacity, etc."
                          ></textarea>
                        </div>
                        <div class="d-grid gap-2 d-md-flex">
                          <button
                            type="button"
                            class="btn btn-success flex-fill"
                            onclick="saveRoom()"
                          >
                            <i class="bi bi-check-lg"></i> Save Room
                          </button>
                          <button
                            type="button"
                            class="btn btn-danger"
                            onclick="deleteRoom()"
                            disabled
                            id="deleteRoomBtn"
                          >
                            <i class="bi bi-trash"></i> Delete
                          </button>
                        </div>
                      </form>
                    </div>

                    <!-- Staff Tab -->
                    <div class="tab-pane fade" id="staff" role="tabpanel">
                      <div class="mt-3">
                        <label class="form-label">Staff in Selected Room</label>
                        <select
                          class="form-select"
                          id="staffSelector"
                          onchange="selectStaffFromList()"
                        >
                          <option value="">Select staff member...</option>
                        </select>
                      </div>

                      <form id="staffForm">
                        <input type="hidden" id="staffId" />
                        <div class="mb-3">
                          <label class="form-label">Staff Name</label>
                          <input
                            type="text"
                            id="staffName"
                            class="form-control"
                            placeholder="e.g., Mr. Ali"
                          />
                        </div>
                        <div class="mb-3">
                          <label class="form-label">Role/Position</label>
                          <input
                            type="text"
                            id="staffRole"
                            class="form-control"
                            placeholder="e.g., Professor, Administrator"
                          />
                        </div>
                        <div class="d-grid gap-2 d-md-flex">
                          <button
                            type="button"
                            class="btn btn-success flex-fill"
                            onclick="saveStaff()"
                          >
                            <i class="bi bi-check-lg"></i> Save Staff
                          </button>
                          <button
                            type="button"
                            class="btn btn-danger"
                            onclick="deleteStaff()"
                            disabled
                            id="deleteStaffBtn"
                          >
                            <i class="bi bi-trash"></i> Delete
                          </button>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- TAB 2: Notifications -->
            <div class="tab-pane fade" id="notifications" role="tabpanel">
              <!-- Quick Notifications -->
              <div class="section-card">
                <div class="section-header">
                  <h5 class="mb-0">
                    <i class="bi bi-megaphone me-2"></i>Quick Notifications
                  </h5>
                </div>
                <div class="section-body">
                  <div class="btn-group-vertical w-100" role="group">
                    <button
                      type="button"
                      class="btn btn-outline-primary text-start"
                      onclick="sendMaintenanceNotification()"
                    >
                      <i class="bi bi-tools me-2"></i>
                      Send Maintenance Alert
                    </button>
                    <button
                      type="button"
                      class="btn btn-outline-primary text-start"
                      onclick="sendCustomNotification()"
                    >
                      <i class="bi bi-megaphone me-2"></i>
                      Send Custom Announcement
                    </button>
                    <button
                      type="button"
                      class="btn btn-outline-danger text-start"
                      onclick="sendEmergencyNotification()"
                    >
                      <i class="bi bi-exclamation-triangle me-2"></i>
                      Emergency Broadcast
                    </button>
                  </div>

                  <div class="mt-3 p-3 bg-light rounded">
                    <h6>
                      <i class="bi bi-clock-history me-2"></i>Recent
                      Notifications
                    </h6>
                    <div id="recentNotifications" class="mt-2">
                      <small class="text-muted">No recent notifications</small>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- TAB 3: Documents -->
            <div class="tab-pane fade" id="documents" role="tabpanel">
              <div class="section-card">
                <div class="section-header">
                  <h5 class="mb-0">PDF Document Management</h5>
                </div>
                <div class="section-body">
                  <form id="pdfUploadForm">
                    <div class="mb-3">
                      <label class="form-label">Document Title</label>
                      <input
                        type="text"
                        id="pdfTitle"
                        class="form-control"
                        placeholder="e.g., Campus Map, Event Schedule"
                        required
                      />
                    </div>
                    <div class="mb-3">
                      <label class="form-label">Select PDF File</label>
                      <input
                        type="file"
                        id="pdfFile"
                        class="form-control"
                        accept=".pdf"
                        required
                      />
                      <small class="text-muted"
                        >Only PDF files are allowed (Max: 10MB)</small
                      >
                    </div>
                    <div class="mb-3">
                      <label class="form-label">Category</label>
                      <select id="pdfCategory" class="form-select">
                        <option value="campus">Campus Information</option>
                        <option value="academic">Academic</option>
                        <option value="event">Events</option>
                        <option value="facility">Facilities</option>
                        <option value="other">Other</option>
                      </select>
                    </div>
                    <div class="d-grid">
                      <button type="submit" class="btn btn-primary">
                        <i class="bi bi-upload"></i> Upload PDF
                      </button>
                    </div>
                  </form>

                  <div class="mt-4">
                    <div
                      class="d-flex justify-content-between align-items-center mb-2"
                    >
                      <h6 class="mb-0">Existing Documents</h6>
                      <small class="text-muted" id="documentCount">(0)</small>
                    </div>

                    <!-- Compact Collapsible Documents Table -->
                    <div class="accordion" id="documentsAccordion">
                      <div class="accordion-item">
                        <h2 class="accordion-header">
                          <button
                            class="accordion-button collapsed py-2"
                            type="button"
                            data-bs-toggle="collapse"
                            data-bs-target="#documentsCollapse"
                            aria-expanded="false"
                            aria-controls="documentsCollapse"
                          >
                            <i class="bi bi-chevron-down me-2 fs-6"></i>
                            <small>Manage Documents</small>
                            <span
                              class="badge bg-secondary ms-2 fs-6 px-1"
                              id="documentsBadge"
                              >0</span
                            >
                          </button>
                        </h2>
                        <div
                          id="documentsCollapse"
                          class="accordion-collapse collapse"
                          data-bs-parent="#documentsAccordion"
                        >
                          <div class="accordion-body p-1">
                            <div
                              id="pdfList"
                              class="table-responsive"
                              style="max-height: 300px; overflow-y: auto"
                            >
                              <table
                                class="table table-sm table-borderless mb-0"
                              >
                                <thead class="bg-light">
                                  <tr>
                                    <th class="py-1 px-2">
                                      <small>Title</small>
                                    </th>
                                    <th class="py-1 px-2 text-center">
                                      <small>Cat</small>
                                    </th>
                                    <th class="py-1 px-2 text-center">
                                      <small>Size</small>
                                    </th>
                                    <th class="py-1 px-2 text-center">
                                      <small>Actions</small>
                                    </th>
                                  </tr>
                                </thead>
                                <tbody id="pdfTableBody">
                                  <tr>
                                    <td
                                      colspan="4"
                                      class="text-center text-muted py-2"
                                    >
                                      <small>No documents uploaded yet</small>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- TAB 4: Settings (Placeholder for Future) -->
            <div class="tab-pane fade" id="settings" role="tabpanel">
              <div class="section-card">
                <div class="section-header">
                  <h5 class="mb-0">
                    <i class="bi bi-gear me-2"></i>System Settings
                  </h5>
                </div>
                <div class="section-body text-center py-4">
                  <i class="bi bi-tools display-4 text-muted"></i>
                  <h6 class="mt-3 text-muted">Settings Panel</h6>
                  <p class="text-muted small">
                    This section is under development and will be available
                    soon.
                  </p>
                  <button class="btn btn-outline-secondary btn-sm" disabled>
                    Coming Soon
                  </button>
                </div>
              </div>

              <!-- Future Features Placeholder -->
              <div class="section-card mt-3">
                <div class="section-header">
                  <h5 class="mb-0">
                    <i class="bi bi-plus-circle me-2"></i>Future Features
                  </h5>
                </div>
                <div class="section-body">
                  <div class="list-group list-group-flush">
                    <div
                      class="list-group-item d-flex justify-content-between align-items-center"
                    >
                      <small>User Management</small>
                      <span class="badge bg-secondary">Planned</span>
                    </div>
                    <div
                      class="list-group-item d-flex justify-content-between align-items-center"
                    >
                      <small>Analytics Dashboard</small>
                      <span class="badge bg-secondary">Planned</span>
                    </div>
                    <div
                      class="list-group-item d-flex justify-content-between align-items-center"
                    >
                      <small>Backup & Restore</small>
                      <span class="badge bg-secondary">Planned</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-draw/dist/leaflet.draw.js"></script>
    <script type="module" src="../js/admin.js"></script>

    <script>
      function showInfoModal(data) {
        document.getElementById("modalTitle").innerText =
          data.title || "Maklumat";

        const carouselItems = document.getElementById("carouselItems");
        carouselItems.innerHTML = ""; // kosongkan dulu

        data.items.forEach((item, index) => {
          const active = index === 0 ? "active" : "";
          carouselItems.innerHTML += `
      <div class="carousel-item ${active}">
        <div class="text-center">
          <img src="${item.image}" class="img-fluid rounded" alt="Image">
          <p class="mt-3">${item.desc}</p>
        </div>
      </div>
    `;
        });

        const modal = new bootstrap.Modal(document.getElementById("infoModal"));
        modal.show();
      }
    </script>

    <!-- Sidebar functionality -->
    <script>
      function goBack() {
        window.location.href = "map.html";
      }

      function SidebarBtn() {
        const sidebar = document.getElementById("sidebarId");
        sidebar.classList.toggle("active");
      }

      function closebtn() {
        const close = document.getElementById("sidebarId");
        close.classList.remove("active");
      }

      document.addEventListener("click", function (event) {
        const sidebar = document.getElementById("sidebarId");
        const togglebtn = document.querySelector(".bi-list");

        if (
          sidebar.classList.contains("active") &&
          !sidebar.contains(event.target) &&
          !togglebtn.contains(event.target)
        ) {
          sidebar.classList.remove("active");
        }
      });

      // Dark mode functionality
      document.addEventListener("DOMContentLoaded", function () {
        const darkModeToggle = document.getElementById("darkModeToggle");
        const prefersDarkScheme = window.matchMedia(
          "(prefers-color-scheme: dark)"
        );

        // Check for saved theme preference or use OS preference
        const currentTheme = localStorage.getItem("darkMode");
        if (
          currentTheme === "true" ||
          (!currentTheme && prefersDarkScheme.matches)
        ) {
          document.body.classList.add("dark-mode");
          darkModeToggle.checked = true;
        }

        // Toggle dark mode
        darkModeToggle.addEventListener("change", function () {
          if (this.checked) {
            document.body.classList.add("dark-mode");
            localStorage.setItem("darkMode", "true");
          } else {
            document.body.classList.remove("dark-mode");
            localStorage.setItem("darkMode", "false");
          }
        });
      });
    </script>
  </body>
</html>
